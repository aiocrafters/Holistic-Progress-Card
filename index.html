<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Holistic Progress Card</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- jsPDF + html2canvas (for PDF export) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  body{font-family:"Segoe UI",sans-serif;background:#f5faff;padding:20px}
  .report-card{background:#fff;max-width:900px;margin:auto;border:2px solid #333;padding:20px;border-radius:10px}
  h2,h3,h4{text-align:center;margin:5px 0}
  table{border-collapse:collapse;width:100%;margin-top:10px}
  th,td{border:1px solid #666;text-align:center;padding:6px}
  th{background:#d6e4ff}
  input[type=text],input[type=number],input[type=date]{width:100%;border:none;text-align:center;font-size:14px}
  input[readonly]{background:#f0f0f0}
  textarea{width:100%;border:1px solid #ccc;border-radius:5px}
  .section{margin-top:20px}
  .info-table td{border:none;padding:5px 10px}
  .info-table td.label{font-weight:bold;text-align:left}
  .info-table td input.bold-input{font-weight:bold;text-align:left}
  .grade-key,.proficiency{border:1px solid #999;padding:10px;margin-top:10px}
  .footer{margin-top:20px}
  button{margin-top:20px;width:100%;padding:10px;background:#3f51b5;color:#fff;border:none;font-size:16px;border-radius:5px;cursor:pointer}
  button:hover{background:#283593}
  .proficiency i{font-size:36px;display:block;margin:auto;padding:5px;border-radius:10px;color:gray;transition:all .3s}
  .proficiency i.active{color:#3f51b5;border:2px solid #3f51b5}
  .print-btn{background:#1a73e8}
  @media print{
    body{background:white;margin:0;padding:10mm}
    button,.print-btn{display:none}
    input,textarea{border:none !important;background:transparent !important}
    .report-card{border:2px solid #000}
  }
</style>
</head>
<body>

<div class="report-card">
  <h2>GOVERNMENT BOYS MIDDLE SCHOOL NANINARA</h2>
  <h3>ZONE SUMBAL DISTRICT BANDIPORA</h3>
  <h3>HOLISTIC PROGRESS CARD FOR THE YEAR 2025</h3>

  <!-- Student Info -->
  <table class="info-table">
    <tr>
      <td class="label">Student Name:</td>
      <td><input type="text" id="studentName" class="bold-input"></td>
      <td class="label">Adm. No:</td>
      <td><input type="text" id="admNo" class="bold-input"></td>
    </tr>
    <tr>
      <td class="label">Father's Name:</td>
      <td><input type="text" id="fatherName" class="bold-input"></td>
      <td class="label">Pen No:</td>
      <td><input type="text" id="penName" class="bold-input"></td>
    </tr>
    <tr>
      <td class="label">Mother's Name:</td>
      <td><input type="text" id="motherName" class="bold-input"></td>
      <td class="label">Class:</td>
      <td><input type="text" id="className" class="bold-input"></td>
    </tr>
    <tr>
      <td class="label">Academic Session:</td>
      <td><input type="text" id="session" class="bold-input"></td>
      <td class="label">Roll No:</td>
      <td><input type="text" id="rollNo" class="bold-input"></td>
    </tr>
    <tr>
      <td class="label">D.O.B:</td>
      <td><input type="date" id="dob" class="bold-input"></td>
      <td></td><td></td>
    </tr>
  </table>

  <!-- Marks Table (unchanged) -->
  <div class="section">
    <table id="marksTable">
      <tr>
        <th rowspan="2">Subject</th>
        <th colspan="6">Formative Assessments (5 marks each)</th>
        <th rowspan="2">Total (30)</th>
        <th rowspan="2">Co-Curricular (20)</th>
        <th rowspan="2">Summative (50)</th>
        <th rowspan="2">Total (100)</th>
        <th rowspan="2">Grade</th>
        <th rowspan="2">Proficiency Level</th>
      </tr>
      <tr><th>FA1</th><th>FA2</th><th>FA3</th><th>FA4</th><th>FA5</th><th>FA6</th></tr>

      <!-- English -->
      <tr><td>English</td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" readonly></td><td><input type="number" min="0" max="20"></td>
        <td><input type="number" min="0" max="50"></td>
        <td><input type="number" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td>
      </tr>

      <!-- Math -->
      <tr><td>Math</td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" readonly></td><td><input type="number" min="0" max="20"></td>
        <td><input type="number" min="0" max="50"></td>
        <td><input type="number" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td>
      </tr>

      <!-- Science -->
      <tr><td>Science</td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" readonly></td><td><input type="number" min="0" max="20"></td>
        <td><input type="number" min="0" max="50"></td>
        <td><input type="number" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td>
      </tr>

      <!-- Social Science -->
      <tr><td>Social Science</td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" readonly></td><td><input type="number" min="0" max="20"></td>
        <td><input type="number" min="0" max="50"></td>
        <td><input type="number" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td>
      </tr>

      <!-- Urdu -->
      <tr><td>Urdu</td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" readonly></td><td><input type="number" min="0" max="20"></td>
        <td><input type="number" min="0" max="50"></td>
        <td><input type="number" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td>
      </tr>

      <!-- Kashmiri -->
      <tr><td>Kashmiri</td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" min="0" max="5" step="0.5"></td>
        <td><input type="number" readonly></td><td><input type="number" min="0" max="20"></td>
        <td><input type="number" min="0" max="50"></td>
        <td><input type="number" readonly></td><td><input type="text" readonly></td><td><input type="text" readonly></td>
      </tr>

      <!-- Grand Total -->
      <tr id="grandTotalRow">
        <th colspan="10">Total Marks Obtained</th>
        <td><input type="number" id="grandTotal100" readonly></td>
        <td><input type="text" id="grandGrade" readonly></td>
        <td><input type="text" id="grandProficiency" readonly></td>
      </tr>
    </table>
  </div>

  <!-- Summary -->
  <div class="section">
    <table>
      <tr><td>Max Marks:</td><td><input type="text" id="maxMarks" readonly value="600"></td></tr>
      <tr><td>Total Marks Obtained:</td><td><input type="text" id="totalMarks" readonly></td></tr>
      <tr><td>Overall Percentage:</td><td><input type="text" id="overallPercent" readonly></td></tr>
      <tr><td>Overall Grade:</td><td><input type="text" id="overallGrade" readonly></td></tr>
      <tr><td>Result:</td><td><input type="text" id="result" readonly></td></tr>
    </table>
  </div>

  <!-- Grade Key -->
  <div class="grade-key section">
    <h4>Percentage / Grade Key</h4>
    <table>
      <tr><th>Percentage</th><th>Grade</th></tr>
      <tr><td>>85% to 100%</td><td>A+</td></tr>
      <tr><td>>70% to 85%</td><td>A</td></tr>
      <tr><td>>55% to 70%</td><td>B</td></tr>
      <tr><td>>40% to 55%</td><td>C</td></tr>
      <tr><td>>33% to 40%</td><td>D</td></tr>
    </table>
    <h4>Proficiency Ranges</h4>
    <table>
      <tr><th>Range</th><th>Level</th></tr>
      <tr><td>0–59%</td><td>Stream</td></tr>
      <tr><td>60–84%</td><td>Mountain</td></tr>
      <tr><td>85–100%</td><td>Sky</td></tr>
    </table>
  </div>

  <!-- Proficiency Icons -->
  <div class="proficiency section">
    <h4>Level of Proficiency</h4>
    <table>
      <tr><th>Stream</th><th>Mountain</th><th>Sky</th></tr>
      <tr>
        <td><i class="fas fa-water" id="streamIcon"></i></td>
        <td><i class="fas fa-mountain" id="mountainIcon"></i></td>
        <td><i class="fas fa-sun" id="skyIcon"></i></td>
      </tr>
    </table>
  </div>

  <!-- Remarks -->
  <div class="section footer">
    <h4>Form Teacher Remarks</h4>
    <textarea rows="3" placeholder="Enter remarks here..."></textarea>
    <table>
      <tr><td>Sign. Class Teacher:</td><td><input type="text"></td></tr>
      <tr><td>Sign. Exam I/C:</td><td><input type="text"></td></tr>
      <tr><td>Parent’s Signature:</td><td><input type="text"></td></tr>
    </table>
  </div>

  <p style="text-align:center;margin-top:20px;"><em>Seal & Signature of HOI</em></p>

  <!-- NEP Note -->
  <div class="section" style="margin-top:20px;background:#e8f0ff;padding:10px;border-left:4px solid #3f51b5;border-radius:5px;">
    <strong>Note (As per NEP 2020):</strong>
    <p style="margin:5px 0;">This Holistic Progress Card reflects comprehensive growth of the learner — academic, emotional, physical, and social — rather than marks alone. The purpose is to encourage continuous learning, curiosity, and skill development in every student.</p>
  </div>

  <!-- Buttons -->
  <button type="button" class="print-btn" onclick="window.print()">Print Report Card</button>
  <button type="button" onclick="exportToPDF()">Export to PDF (A4)</button>
</div>

<script>
/* ---------- Calculations ---------- */
document.addEventListener("DOMContentLoaded", () => {
  const table = document.getElementById("marksTable");

  const grade = t => t>85?"A+":t>70?"A":t>55?"B":t>40?"C":t>33?"D":"F";
  const prof  = t => t<60?"Stream":t<85?"Mountain":"Sky";

  const updateProfIcon = lvl => {
    ["streamIcon","mountainIcon","skyIcon"].forEach(id=>document.getElementById(id).classList.remove("active"));
    if(lvl==="Stream")   document.getElementById("streamIcon").classList.add("active");
    if(lvl==="Mountain") document.getElementById("mountainIcon").classList.add("active");
    if(lvl==="Sky")      document.getElementById("skyIcon").classList.add("active");
  };

  const clamp = (val, min, max) => Math.max(min, Math.min(max, val));

  const updateAll = () => {
    const rows = table.querySelectorAll("tr:not(:first-child):not(:nth-child(2)):not(#grandTotalRow)");
    let totalSum = 0, subjCount = 0;

    rows.forEach(r => {
      const inp = r.querySelectorAll("input[type='number']");
      const fa = Array.from(inp).slice(0,6);
      const total30 = inp[6];
      const co = inp[7];
      const sum = inp[8];
      const total100 = inp[9];
      const g = r.querySelectorAll("input[type='text']")[0];
      const p = r.querySelectorAll("input[type='text']")[1];

      // clamp FA
      fa.forEach(i=>i.value = clamp(+i.value||0,0,5));
      co.value = clamp(+co.value||0,0,20);
      sum.value = clamp(+sum.value||0,0,50);

      const faTot = fa.reduce((s,i)=>s+(+i.value||0),0);
      total30.value = faTot;

      const tot = faTot + (+co.value||0) + (+sum.value||0);
      total100.value = tot;
      g.value = grade(tot);
      p.value = prof(tot);

      if(tot>0){ totalSum += tot; subjCount++; }
    });

    const grandTot = document.getElementById("grandTotal100");
    const grandG   = document.getElementById("grandGrade");
    const grandP   = document.getElementById("grandProficiency");

    if(subjCount>0){
      const avg = totalSum/subjCount;
      grandTot.value = totalSum;
      const pl = prof(avg);
      grandG.value = grade(avg);
      grandP.value = pl;
      updateProfIcon(pl);
    }

    const totM = document.getElementById("totalMarks");
    const maxM = document.getElementById("maxMarks");
    const perc = document.getElementById("overallPercent");
    const oG   = document.getElementById("overallGrade");
    const res  = document.getElementById("result");

    const max = +maxM.value || 600;
    totM.value = grandTot.value||0;
    const pct = ((+totM.value/max)*100).toFixed(2);
    perc.value = pct + "%";
    oG.value = grandG.value;
    res.value = pct>=33?"PASS":"FAIL";
    res.style.color = pct>=33?"green":"red";
    res.style.fontWeight = "bold";
  };

  table.addEventListener("input", updateAll);
  updateAll();   // initial run
});

/* ---------- PDF Export ---------- */
async function exportToPDF() {
  const { jsPDF } = window.jspdf;
  const element = document.querySelector(".report-card");
  const opt = { background: 'white', scale: 2 };

  try {
    const canvas = await html2canvas(element, opt);
    const imgData = canvas.toDataURL('image/png');

    const pdf = new jsPDF('p', 'mm', 'a4');
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();

    const imgWidth = canvas.width;
    const imgHeight = canvas.height;
    const ratio = imgWidth / imgHeight;
    let width = pdfWidth;
    let height = width / ratio;

    if (height > pdfHeight) {
      height = pdfHeight;
      width = height * ratio;
    }

    const x = (pdfWidth - width) / 2;
    const y = (pdfHeight - height) / 2;

    pdf.addImage(imgData, 'PNG', x, y, width, height);
    pdf.save(`Holistic_Progress_Card_${document.getElementById('studentName').value||'Student'}.pdf`);
  } catch (e) {
    alert("PDF generation failed: " + e);
  }
}
</script>
</body>
</html>